<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f5f7fb;
            min-height: 100vh;
        }
        .section-card {
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            background: #ffffff;
            margin-bottom: 24px;
            padding: 24px;
        }
        .section-title {
            font-weight: 700;
            margin-bottom: 16px;
        }
        .pill-button {
            border-radius: 999px;
        }
        .chart-card canvas {
            max-height: 340px;
        }
        .table thead {
            background-color: #1f6feb;
            color: white;
        }
        .default-badge {
            background-color: #e2eaff;
            color: #1f6feb;
            border-radius: 999px;
            padding: 2px 10px;
            font-size: 12px;
        }
        .chart-legend-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            padding: 4px 0;
            border-bottom: 1px dashed #e5e7eb;
        }
        .chart-legend-item:last-child {
            border-bottom: none;
        }
        .chart-legend-amount {
            font-weight: 600;
        }
        .multi-select {
            min-width: 220px;
        }
        .detail-expense-list .list-group-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .detail-expense-meta {
            font-size: 0.85rem;
            color: #6c757d;
        }
        .table-checkbox {
            width: 40px;
        }
        .operations-actions {
            gap: 0.5rem;
        }
        .operations-actions .btn {
            white-space: nowrap;
        }
    </style>
</head>
<body>
<div id="loader" class="spinner-border text-primary position-fixed top-50 start-50" style="display:none"></div>
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold">–§–∏–Ω–∞–Ω—Å—ã –∏ –±—é–¥–∂–µ—Ç</h1>
            <p class="text-muted mb-0">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –±—é–¥–∂–µ—Ç, —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –¥–æ—Ö–æ–¥–∞–º–∏ –∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∏–Ω–∞–º–∏–∫—É –∫–∞–∫ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –±–∞–Ω–∫–µ</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary pill-button" onclick="window.location.href='/new-tracker.html'">üìã –ù–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</button>
            <button class="btn btn-outline-secondary pill-button" onclick="window.location.href='/tracker.html'">‚è± –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–µ—Ä</button>
            <button class="btn btn-primary pill-button" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div class="alert" id="message"></div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π</h2>
                <p class="text-muted mb-0">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–∑—É –¥–µ—Å—è—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π, –∑–∞–¥–∞–≤–∞—è –æ–±—â–∏–π –º–µ—Å—è—Ü –∏ –±—ã—Å—Ç—Ä–æ –∫–æ–ø–∏—Ä—É—è –¥–∞–Ω–Ω—ã–µ</p>
            </div>
            <div class="btn-group" role="group">
                <button class="btn btn-outline-primary active" id="toggleExpenses">–†–∞—Å—Ö–æ–¥—ã</button>
                <button class="btn btn-outline-success" id="toggleIncomes">–î–æ—Ö–æ–¥—ã</button>
            </div>
        </div>
        <div id="expenseBatchSection" class="batch-section">
            <div class="d-flex flex-wrap gap-3 mb-3">
                <div>
                    <label for="expenseDefaultMonth" class="form-label mb-1">–û–±—â–∏–π –º–µ—Å—è—Ü</label>
                    <input type="month" id="expenseDefaultMonth" class="form-control">
                </div>
                <div class="align-self-end">
                    <button class="btn btn-outline-primary pill-button" id="applyExpenseMonth">–ü—Ä–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—è—Ü –≤—Å–µ–º</button>
                </div>
            </div>
            <div class="table-responsive mb-3">
                <table class="table table-hover align-middle">
                    <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ—Å—è—Ü</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="expenseBatchTable"></tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between flex-wrap gap-2">
                <button class="btn btn-outline-secondary pill-button" id="addExpenseRow">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
                <button class="btn btn-primary pill-button" id="saveExpenseBatch">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</button>
            </div>
        </div>
        <div id="incomeBatchSection" class="batch-section" style="display:none">
            <div class="d-flex flex-wrap gap-3 mb-3">
                <div>
                    <label for="incomeDefaultMonth" class="form-label mb-1">–û–±—â–∏–π –º–µ—Å—è—Ü</label>
                    <input type="month" id="incomeDefaultMonth" class="form-control">
                </div>
                <div class="align-self-end">
                    <button class="btn btn-outline-success pill-button" id="applyIncomeMonth">–ü—Ä–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—è—Ü –≤—Å–µ–º</button>
                </div>
            </div>
            <div class="table-responsive mb-3">
                <table class="table table-hover align-middle">
                    <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ—Å—è—Ü</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="incomeBatchTable"></tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between flex-wrap gap-2">
                <button class="btn btn-outline-secondary pill-button" id="addIncomeRow">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
                <button class="btn btn-success pill-button" id="saveIncomeBatch">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–æ—Ö–æ–¥—ã</button>
            </div>
        </div>
    </div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
            <div>
                <h2 class="section-title mb-1">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã</h2>
                <p class="text-muted mb-0">–í—ã–±–∏—Ä–∞–π—Ç–µ –º–µ—Å—è—Ü –∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –¥–∏–Ω–∞–º–∏–∫–µ</p>
            </div>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <button id="analyticsSectionToggle"
                        class="btn btn-outline-secondary pill-button"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#analyticsSectionCollapse"
                        aria-expanded="true"
                        aria-controls="analyticsSectionCollapse"
                        data-expanded-label="–°–≤–µ—Ä–Ω—É—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É"
                        data-collapsed-label="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É"
                        data-storage-key="finance.analytics">
                    –°–≤–µ—Ä–Ω—É—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                </button>
            </div>
        </div>
        <div id="analyticsSectionCollapse" class="collapse show mt-3">
            <form id="analyticsFilters" class="row gy-2 gx-2 align-items-end">
                <div class="col-auto">
                    <label class="form-label small text-muted mb-1" for="filterFrom">–° –¥–∞—Ç—ã</label>
                    <input type="date" class="form-control" id="filterFrom">
                </div>
                <div class="col-auto">
                    <label class="form-label small text-muted mb-1" for="filterTo">–ü–æ –¥–∞—Ç—É</label>
                    <input type="date" class="form-control" id="filterTo">
                </div>
                <div class="col-auto">
                    <label class="form-label small text-muted mb-1" for="filterMonth">–ú–µ—Å—è—Ü</label>
                    <input type="month" class="form-control" id="filterMonth">
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-muted mb-1" for="expenseFilterCategories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</label>
                    <select id="expenseFilterCategories" class="form-select multi-select" multiple size="4"></select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-muted mb-1" for="incomeFilterCategories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤</label>
                    <select id="incomeFilterCategories" class="form-select multi-select" multiple size="4"></select>
                </div>
                <div class="col-auto align-self-end">
                    <button type="submit" class="btn btn-outline-primary pill-button">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </form>
            <div class="row g-3 mb-3" id="dashboardSummary"></div>
            <div class="row g-4">
                <div class="col-xl-4">
                    <div class="card h-100 chart-card">
                        <div class="card-body">
                            <h5 class="card-title">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                            <canvas id="expenseByCategoryChart"></canvas>
                            <div class="mt-3" id="expenseByCategoryLegend"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card h-100 chart-card">
                        <div class="card-body">
                            <h5 class="card-title">–î–æ—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                            <canvas id="incomeByCategoryChart"></canvas>
                            <div class="mt-3" id="incomeByCategoryLegend"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card h-100 chart-card">
                        <div class="card-body">
                            <h5 class="card-title">–ë–∞–ª–∞–Ω—Å –ø–æ –º–µ—Å—è—Ü–∞–º</h5>
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card mt-4">
                <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
                        <h5 class="card-title mb-0">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                        <div id="categoryToggleContainer" class="d-flex flex-wrap gap-2"></div>
                    </div>
                    <canvas id="categoryTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤</h2>
                <p class="text-muted mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</p>
            </div>
        </div>
        <form id="detailFilterForm" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label small text-muted mb-1" for="detailFrom">–° –¥–∞—Ç—ã</label>
                <input type="date" class="form-control" id="detailFrom" required>
            </div>
            <div class="col-md-3">
                <label class="form-label small text-muted mb-1" for="detailTo">–ü–æ –¥–∞—Ç—É</label>
                <input type="date" class="form-control" id="detailTo" required>
            </div>
            <div class="col-md-4">
                <label class="form-label small text-muted mb-1" for="detailCategories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</label>
                <select id="detailCategories" class="form-select multi-select" multiple size="4"></select>
                <div class="form-text">–ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
            </div>
            <div class="col-md-2 align-self-end">
                <button type="submit" class="btn btn-primary pill-button w-100">–ü–æ–∫–∞–∑–∞—Ç—å</button>
            </div>
        </form>
        <div class="row g-4 mt-2">
            <div class="col-lg-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                            <span class="badge bg-light text-dark" id="detailTotalsAmount">0 ‚ÇΩ</span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead>
                                <tr>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th class="text-end">–°—É–º–º–∞</th>
                                    <th class="text-end">–î–æ–ª—è</th>
                                </tr>
                                </thead>
                                <tbody id="detailCategoryBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body detail-expense-list">
                        <h5 class="card-title">–°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π</h5>
                        <div id="detailExpenseList" class="list-group list-group-flush"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏</h2>
                <p class="text-muted mb-0">–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã, –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∑–∞–ø–∏—Å—è–º</p>
            </div>
        </div>
        <ul class="nav nav-pills mb-3" id="financeOperationsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="expenseOperationsTab" data-bs-toggle="pill" data-bs-target="#expenseOperations" type="button" role="tab" aria-controls="expenseOperations" aria-selected="true">–†–∞—Å—Ö–æ–¥—ã</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="incomeOperationsTab" data-bs-toggle="pill" data-bs-target="#incomeOperations" type="button" role="tab" aria-controls="incomeOperations" aria-selected="false">–î–æ—Ö–æ–¥—ã</button>
            </li>
        </ul>
        <div class="tab-content" id="financeOperationsContent">
            <div class="tab-pane fade show active" id="expenseOperations" role="tabpanel" aria-labelledby="expenseOperationsTab">
                <form id="expenseManageFilterForm" class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label small text-muted mb-1" for="expenseManageFrom">–° –¥–∞—Ç—ã</label>
                        <input type="date" class="form-control" id="expenseManageFrom" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small text-muted mb-1" for="expenseManageTo">–ü–æ –¥–∞—Ç—É</label>
                        <input type="date" class="form-control" id="expenseManageTo" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small text-muted mb-1" for="expenseManageCategories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</label>
                        <select id="expenseManageCategories" class="form-select multi-select" multiple size="4"></select>
                        <div class="form-text">–ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ</div>
                    </div>
                    <div class="col-md-2 align-self-end">
                        <button type="submit" class="btn btn-primary pill-button w-100">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    </div>
                </form>
                <div class="d-flex flex-wrap operations-actions mt-3">
                    <button type="button" class="btn btn-outline-danger" id="expenseBulkDelete" disabled>–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
                    <button type="button" class="btn btn-outline-secondary" id="expenseBulkCategoryBtn" disabled>–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                </div>
                <div class="table-responsive mt-3">
                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th class="table-checkbox"><input class="form-check-input" type="checkbox" id="expenseSelectAll"></th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–î–∞—Ç–∞ / –º–µ—Å—è—Ü</th>
                            <th class="text-end">–°—É–º–º–∞</th>
                            <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                        </thead>
                        <tbody id="expenseManageBody">
                        <tr><td colspan="6" class="text-muted text-center">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane fade" id="incomeOperations" role="tabpanel" aria-labelledby="incomeOperationsTab">
                <form id="incomeManageFilterForm" class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label small text-muted mb-1" for="incomeManageFrom">–° –¥–∞—Ç—ã</label>
                        <input type="date" class="form-control" id="incomeManageFrom" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small text-muted mb-1" for="incomeManageTo">–ü–æ –¥–∞—Ç—É</label>
                        <input type="date" class="form-control" id="incomeManageTo" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small text-muted mb-1" for="incomeManageCategories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤</label>
                        <select id="incomeManageCategories" class="form-select multi-select" multiple size="4"></select>
                        <div class="form-text">–ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ</div>
                    </div>
                    <div class="col-md-2 align-self-end">
                        <button type="submit" class="btn btn-primary pill-button w-100">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    </div>
                </form>
                <div class="d-flex flex-wrap operations-actions mt-3">
                    <button type="button" class="btn btn-outline-danger" id="incomeBulkDelete" disabled>–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
                    <button type="button" class="btn btn-outline-secondary" id="incomeBulkCategoryBtn" disabled>–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                </div>
                <div class="table-responsive mt-3">
                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th class="table-checkbox"><input class="form-check-input" type="checkbox" id="incomeSelectAll"></th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–î–∞—Ç–∞ / –º–µ—Å—è—Ü</th>
                            <th class="text-end">–°—É–º–º–∞</th>
                            <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                        </thead>
                        <tbody id="incomeManageBody">
                        <tr><td colspan="6" class="text-muted text-center">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
            <div>
                <h2 class="section-title mb-1">–ë—é–¥–∂–µ—Ç –º–µ—Å—è—Ü–∞</h2>
                <p class="text-muted mb-0">–ó–∞–¥–∞–π—Ç–µ —Ü–µ–ª–∏ –ø–æ –¥–æ—Ö–æ–¥–∞–º, —Ä–∞—Å—Ö–æ–¥–∞–º –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º ‚Äî –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
            </div>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <div class="d-flex gap-2">
                    <input type="month" class="form-control" id="budgetMonth">
                    <button class="btn btn-outline-primary pill-button" id="loadBudget">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
                <button id="budgetSectionToggle"
                        class="btn btn-outline-secondary pill-button"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#budgetSectionCollapse"
                        aria-expanded="true"
                        aria-controls="budgetSectionCollapse"
                        data-expanded-label="–°–≤–µ—Ä–Ω—É—Ç—å –±—é–¥–∂–µ—Ç"
                        data-collapsed-label="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±—é–¥–∂–µ—Ç"
                        data-storage-key="finance.budget">
                    –°–≤–µ—Ä–Ω—É—Ç—å –±—é–¥–∂–µ—Ç
                </button>
            </div>
        </div>
        <div id="budgetSectionCollapse" class="collapse show mt-3">
            <form id="budgetForm" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">–ü–ª–∞–Ω –¥–æ—Ö–æ–¥–æ–≤</label>
                    <input type="number" min="0" step="0.01" class="form-control" id="plannedIncome" placeholder="0.00">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ü–ª–∞–Ω —Ä–∞—Å—Ö–æ–¥–æ–≤</label>
                    <input type="number" min="0" step="0.01" class="form-control" id="plannedExpense" placeholder="0.00">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–¶–µ–ª—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π</label>
                    <input type="number" min="0" step="0.01" class="form-control" id="savingsGoal" placeholder="0.00">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ó–∞–º–µ—Ç–∫–∞</label>
                    <input type="text" class="form-control" id="budgetNotes" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
                </div>
                <div class="col-12 d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary pill-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç</button>
                </div>
            </form>
            <div class="row g-4 mt-2" id="budgetSummaryCards"></div>
        </div>
    </div>

    <div class="section-card mb-5">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
            <div>
                <h2 class="section-title mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <p class="text-muted mb-0">–°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤, —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É</p>
            </div>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <button class="btn btn-outline-primary pill-button" id="refreshCategoriesBtn">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–∫–∏</button>
                <button id="categorySectionToggle"
                        class="btn btn-outline-secondary pill-button"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#categorySectionCollapse"
                        aria-expanded="true"
                        aria-controls="categorySectionCollapse"
                        data-expanded-label="–°–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                        data-collapsed-label="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                        data-storage-key="finance.categories">
                    –°–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                </button>
            </div>
        </div>
        <div id="categorySectionCollapse" class="collapse show mt-3">
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h5>
                            <form id="expenseCategoryForm" class="row g-2 mb-3">
                                <div class="col-md-5">
                                    <input type="text" class="form-control" id="expenseCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                                </div>
                                <div class="col-md-5">
                                    <input type="text" class="form-control" id="expenseCategoryDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                                </div>
                                <div class="col-md-2 d-grid">
                                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </form>
                            <div class="table-responsive">
                                <table class="table table-sm align-middle">
                                    <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                    </thead>
                                    <tbody id="expenseCategoryTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤</h5>
                            <form id="incomeCategoryForm" class="row g-2 mb-3">
                                <div class="col-md-5">
                                    <input type="text" class="form-control" id="incomeCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                                </div>
                                <div class="col-md-5">
                                    <input type="text" class="form-control" id="incomeCategoryDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                                </div>
                                <div class="col-md-2 d-grid">
                                    <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </form>
                            <div class="table-responsive">
                                <table class="table table-sm align-middle">
                                    <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                    </thead>
                                    <tbody id="incomeCategoryTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editExpenseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <form class="modal-content" id="editExpenseForm">
            <div class="modal-header">
                <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ç—ã</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editExpenseId">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label" for="editExpenseTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-control" id="editExpenseTitle" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editExpenseAmount">–°—É–º–º–∞</label>
                        <input type="number" class="form-control" id="editExpenseAmount" min="0" step="0.01" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editExpenseCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select class="form-select" id="editExpenseCategory" required></select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editExpenseDate">–¢–æ—á–Ω–∞—è –¥–∞—Ç–∞</label>
                        <input type="date" class="form-control" id="editExpenseDate">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editExpensePeriod">–ú–µ—Å—è—Ü (–µ—Å–ª–∏ –±–µ–∑ –¥–∞—Ç—ã)</label>
                        <input type="month" class="form-control" id="editExpensePeriod">
                        <div class="form-text">–£–∫–∞–∂–∏—Ç–µ –ª–∏–±–æ –¥–∞—Ç—É, –ª–∏–±–æ –º–µ—Å—è—Ü. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞, –º–µ—Å—è—Ü –≤—ã—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
                    </div>
                    <div class="col-12">
                        <label class="form-label" for="editExpenseDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="editExpenseDescription" rows="2" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="editIncomeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <form class="modal-content" id="editIncomeForm">
            <div class="modal-header">
                <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editIncomeId">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label" for="editIncomeTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-control" id="editIncomeTitle" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editIncomeAmount">–°—É–º–º–∞</label>
                        <input type="number" class="form-control" id="editIncomeAmount" min="0" step="0.01" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editIncomeCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select class="form-select" id="editIncomeCategory" required></select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editIncomeDate">–¢–æ—á–Ω–∞—è –¥–∞—Ç–∞</label>
                        <input type="date" class="form-control" id="editIncomeDate">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="editIncomePeriod">–ú–µ—Å—è—Ü (–µ—Å–ª–∏ –±–µ–∑ –¥–∞—Ç—ã)</label>
                        <input type="month" class="form-control" id="editIncomePeriod">
                        <div class="form-text">–£–∫–∞–∂–∏—Ç–µ –ª–∏–±–æ –¥–∞—Ç—É, –ª–∏–±–æ –º–µ—Å—è—Ü. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞, –º–µ—Å—è—Ü –≤—ã—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
                    </div>
                    <div class="col-12">
                        <label class="form-label" for="editIncomeDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="editIncomeDescription" rows="2" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="expenseBulkCategoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <form class="modal-content" id="expenseBulkCategoryForm">
            <div class="modal-header">
                <h5 class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∞—Å—Ö–æ–¥–æ–≤</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="bulkExpenseCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="bulkExpenseCategory" class="form-select" required></select>
                </div>
                <p class="text-muted small mb-0">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–æ –≤—Å–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ç—Ä–∞—Ç–∞–º.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="incomeBulkCategoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <form class="modal-content" id="incomeBulkCategoryForm">
            <div class="modal-header">
                <h5 class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ—Ö–æ–¥–æ–≤</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="bulkIncomeCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="bulkIncomeCategory" class="form-select" required></select>
                </div>
                <p class="text-muted small mb-0">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–æ –≤—Å–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–º –¥–æ—Ö–æ–¥–∞–º.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="scripts.js"></script>
<script src="finance.js"></script>
</body>
</html>
