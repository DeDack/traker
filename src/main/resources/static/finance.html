<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f5f7fb;
            min-height: 100vh;
        }
        .section-card {
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            background: #ffffff;
            margin-bottom: 24px;
            padding: 24px;
        }
        .section-title {
            font-weight: 700;
            margin-bottom: 16px;
        }
        .pill-button {
            border-radius: 999px;
        }
        .chart-card canvas {
            max-height: 340px;
        }
        .table thead {
            background-color: #1f6feb;
            color: white;
        }
        .default-badge {
            background-color: #e2eaff;
            color: #1f6feb;
            border-radius: 999px;
            padding: 2px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
<div id="loader" class="spinner-border text-primary position-fixed top-50 start-50" style="display:none"></div>
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold">–§–∏–Ω–∞–Ω—Å—ã –∏ –±—é–¥–∂–µ—Ç</h1>
            <p class="text-muted mb-0">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –±—é–¥–∂–µ—Ç, —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –¥–æ—Ö–æ–¥–∞–º–∏ –∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∏–Ω–∞–º–∏–∫—É –∫–∞–∫ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –±–∞–Ω–∫–µ</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary pill-button" onclick="window.location.href='/tracker.html'">‚è± –¢—Ä–µ–∫–µ—Ä –≤—Ä–µ–º–µ–Ω–∏</button>
            <button class="btn btn-outline-secondary pill-button" onclick="window.location.href='/new-tracker.html'">üìã –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–Ω—è</button>
            <button class="btn btn-primary pill-button" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div class="alert" id="message"></div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <p class="text-muted mb-0">–°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤, —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary pill-button" id="refreshCategoriesBtn">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–∫–∏</button>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h5>
                        <form id="expenseCategoryForm" class="row g-2 mb-3">
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="expenseCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                            </div>
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="expenseCategoryDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                            </div>
                            <div class="col-md-2 d-grid">
                                <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        </form>
                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                                </thead>
                                <tbody id="expenseCategoryTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤</h5>
                        <form id="incomeCategoryForm" class="row g-2 mb-3">
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="incomeCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                            </div>
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="incomeCategoryDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                            </div>
                            <div class="col-md-2 d-grid">
                                <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        </form>
                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                                </thead>
                                <tbody id="incomeCategoryTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π</h2>
                <p class="text-muted mb-0">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–∑—É –¥–µ—Å—è—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π, –∑–∞–¥–∞–≤–∞—è –æ–±—â–∏–π –º–µ—Å—è—Ü –∏ –±—ã—Å—Ç—Ä–æ –∫–æ–ø–∏—Ä—É—è –¥–∞–Ω–Ω—ã–µ</p>
            </div>
            <div class="btn-group" role="group">
                <button class="btn btn-outline-primary active" id="toggleExpenses">–†–∞—Å—Ö–æ–¥—ã</button>
                <button class="btn btn-outline-success" id="toggleIncomes">–î–æ—Ö–æ–¥—ã</button>
            </div>
        </div>
        <div id="expenseBatchSection" class="batch-section">
            <div class="d-flex flex-wrap gap-3 mb-3">
                <div>
                    <label for="expenseDefaultMonth" class="form-label mb-1">–û–±—â–∏–π –º–µ—Å—è—Ü</label>
                    <input type="month" id="expenseDefaultMonth" class="form-control">
                </div>
                <div class="align-self-end">
                    <button class="btn btn-outline-primary pill-button" id="applyExpenseMonth">–ü—Ä–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—è—Ü –≤—Å–µ–º</button>
                </div>
            </div>
            <div class="table-responsive mb-3">
                <table class="table table-hover align-middle">
                    <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ—Å—è—Ü</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="expenseBatchTable"></tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between flex-wrap gap-2">
                <button class="btn btn-outline-secondary pill-button" id="addExpenseRow">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
                <button class="btn btn-primary pill-button" id="saveExpenseBatch">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</button>
            </div>
        </div>
        <div id="incomeBatchSection" class="batch-section" style="display:none">
            <div class="d-flex flex-wrap gap-3 mb-3">
                <div>
                    <label for="incomeDefaultMonth" class="form-label mb-1">–û–±—â–∏–π –º–µ—Å—è—Ü</label>
                    <input type="month" id="incomeDefaultMonth" class="form-control">
                </div>
                <div class="align-self-end">
                    <button class="btn btn-outline-success pill-button" id="applyIncomeMonth">–ü—Ä–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—è—Ü –≤—Å–µ–º</button>
                </div>
            </div>
            <div class="table-responsive mb-3">
                <table class="table table-hover align-middle">
                    <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ—Å—è—Ü</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="incomeBatchTable"></tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between flex-wrap gap-2">
                <button class="btn btn-outline-secondary pill-button" id="addIncomeRow">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
                <button class="btn btn-success pill-button" id="saveIncomeBatch">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–æ—Ö–æ–¥—ã</button>
            </div>
        </div>
    </div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–ë—é–¥–∂–µ—Ç –º–µ—Å—è—Ü–∞</h2>
                <p class="text-muted mb-0">–ó–∞–¥–∞–π—Ç–µ —Ü–µ–ª–∏ –ø–æ –¥–æ—Ö–æ–¥–∞–º, —Ä–∞—Å—Ö–æ–¥–∞–º –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º ‚Äî –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
            </div>
            <div class="d-flex gap-2">
                <input type="month" class="form-control" id="budgetMonth">
                <button class="btn btn-outline-primary pill-button" id="loadBudget">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
        <form id="budgetForm" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">–ü–ª–∞–Ω –¥–æ—Ö–æ–¥–æ–≤</label>
                <input type="number" min="0" step="0.01" class="form-control" id="plannedIncome" placeholder="0.00">
            </div>
            <div class="col-md-3">
                <label class="form-label">–ü–ª–∞–Ω —Ä–∞—Å—Ö–æ–¥–æ–≤</label>
                <input type="number" min="0" step="0.01" class="form-control" id="plannedExpense" placeholder="0.00">
            </div>
            <div class="col-md-3">
                <label class="form-label">–¶–µ–ª—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π</label>
                <input type="number" min="0" step="0.01" class="form-control" id="savingsGoal" placeholder="0.00">
            </div>
            <div class="col-md-3">
                <label class="form-label">–ó–∞–º–µ—Ç–∫–∞</label>
                <input type="text" class="form-control" id="budgetNotes" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
            </div>
            <div class="col-12 d-flex justify-content-end">
                <button type="submit" class="btn btn-primary pill-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç</button>
            </div>
        </form>
        <div class="row g-4 mt-2" id="budgetSummaryCards"></div>
    </div>

    <div class="section-card">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-3 gap-3">
            <div>
                <h2 class="section-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã</h2>
                <p class="text-muted mb-0">–í—ã–±–∏—Ä–∞–π—Ç–µ –º–µ—Å—è—Ü –∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –¥–∏–Ω–∞–º–∏–∫–µ</p>
            </div>
            <form id="analyticsFilters" class="d-flex flex-wrap gap-2">
                <input type="date" class="form-control" id="filterFrom" placeholder="–° –¥–∞—Ç—ã">
                <input type="date" class="form-control" id="filterTo" placeholder="–ü–æ –¥–∞—Ç—É">
                <input type="month" class="form-control" id="filterMonth" placeholder="–ú–µ—Å—è—Ü">
                <button type="submit" class="btn btn-outline-primary pill-button">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </form>
        </div>
        <div class="row g-3 mb-3" id="dashboardSummary"></div>
        <div class="row g-4">
            <div class="col-xl-4">
                <div class="card h-100 chart-card">
                    <div class="card-body">
                        <h5 class="card-title">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                        <canvas id="expenseByCategoryChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="card h-100 chart-card">
                    <div class="card-body">
                        <h5 class="card-title">–î–æ—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                        <canvas id="incomeByCategoryChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="card h-100 chart-card">
                    <div class="card-body">
                        <h5 class="card-title">–ë–∞–ª–∞–Ω—Å –ø–æ –º–µ—Å—è—Ü–∞–º</h5>
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mt-4">
            <div class="card-body">
                <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
                    <h5 class="card-title mb-0">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                    <div id="categoryToggleContainer" class="d-flex flex-wrap gap-2"></div>
                </div>
                <canvas id="categoryTrendChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="scripts.js"></script>
<script src="finance.js"></script>
</body>
</html>
